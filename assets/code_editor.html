<!-- HTML5 -->
<!doctype html>

<script src="codemirror/lib/codemirror.js"></script>
<script src="codemirror/addon/display/fullscreen.js"></script>
<link rel="stylesheet" href="codemirror/lib/codemirror.css">
<link rel="stylesheet" href="codemirror/addon/display/fullscreen.css">
<script src="codemirror/mode/lua/lua.js"></script>

<body>
    <textarea id="code" name="code" style="overflow: scroll;">
print("hello world")
    </textarea>
</body>

<script>
    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        lineNumbers: true,
        mode: "lua",
        lineWrapping: true,
        fullScreen: true,
    });

    //全局变量，触摸开始位置
    var startX = 0, startY = 0;
    
    //touchstart事件
    function touchSatrtFunc(evt) {
        try
        {
            //evt.preventDefault(); //阻止触摸时浏览器的缩放、滚动条滚动等
            var touch = evt.touches[0]; //获取第一个触点
            var x = Number(touch.pageX); //页面触点X坐标
            var y = Number(touch.pageY); //页面触点Y坐标
            //记录触点初始位置
            startX = x;
            startY = y;
            //var text = 'TouchStart事件触发：（' + x + ', ' + y + '）';
            //document.getElementById("result").innerHTML = text;
        }
        catch (e) {
            alert('touchSatrtFunc：' + e.message);
        }
    }

    //touchmove事件，这个事件无法获取坐标
    function touchMoveFunc(evt) {
        try
        {
            //evt.preventDefault(); //阻止触摸时浏览器的缩放、滚动条滚动等
            var touch = evt.touches[0]; //获取第一个触点
            var x = Number(touch.pageX); //页面触点X坐标
            var y = Number(touch.pageY); //页面触点Y坐标

            var text = 'TouchMove事件触发：（' + x + ', ' + y + '）';

            //判断滑动方向
            var textarea = document.getElementById("code");
            if (x - startX != 0) {
                text += '<br/>左右滑动';
                textarea.scrollLeft = textarea.scrollLeft + (startX-x);
                var doc = editor.getDoc();
            //    doc.setValue(text);
            }
            if (y - startY != 0) {
                text += '<br/>上下滑动';
                textarea.scrollTop = textarea.scrollTop + (startY-y);
                var doc = editor.getDoc();
                //doc.setValue(text);
            }

            //document.getElementById("result").innerHTML = text;
        }
        catch (e) {
            alert('touchMoveFunc：' + e.message);
        }
    }

    //touchend事件
    function touchEndFunc(evt) {
        //try {
            //evt.preventDefault(); //阻止触摸时浏览器的缩放、滚动条滚动等

            //var text = 'TouchEnd事件触发';
            //document.getElementById("result").innerHTML = text;
        //}
        //catch (e) {
        //    alert('touchEndFunc：' + e.message);
        //}
    }

    function bindEvent() {
        document.addEventListener('touchstart', touchSatrtFunc, false);
        document.addEventListener('touchmove', touchMoveFunc, false);
        document.addEventListener('touchend', touchEndFunc, false);
    }
    document.createEvent("TouchEvent");
    bindEvent(); //绑定事件

function getCodeString() {
    var doc = editor.getDoc();
    var str = doc.getValue();
    window.Java.SetCodeString(str);
}

function onScroll(l,t,oldl,oldt) {
    var textarea = document.getElementById("code");
    textarea.scrollTop = textarea.scrollTop + (oldt-t);
    textarea.scrollLeft = textarea.scrollLeft + (oldl-l);
}
    //editor.setOption("readOnly", "nocursor");
</script>
